---
interface Props {
  title: string;
  className?: string;
}

const { title, className = "" } = Astro.props;

// 生成稳定的哈希值
const getHash = (str: string) => {
  let hash = 0;
  for (let i = 0; i < str.length; i++) {
    const char = str.charCodeAt(i);
    hash = ((hash << 5) - hash) + char;
    hash = hash & hash;
  }
  return Math.abs(hash);
};

const hash = getHash(title);

// 弥散光感配色方案（更柔和、高级的渐变）
const colorSchemes = [
  { bg: '#e0e7ff', c1: '#818cf8', c2: '#c084fc', c3: '#60a5fa' }, // 蓝紫梦幻
  { bg: '#f0fdf4', c1: '#4ade80', c2: '#2dd4bf', c3: '#34d399' }, // 清新薄荷
  { bg: '#fff1f2', c1: '#fb7185', c2: '#f472b6', c3: '#e879f9' }, // 甜美粉红
  { bg: '#fff7ed', c1: '#fb923c', c2: '#facc15', c3: '#fdba74' }, // 温暖日落
  { bg: '#f8fafc', c1: '#94a3b8', c2: '#64748b', c3: '#cbd5e1' }, // 极简灰调
  { bg: '#ecfeff', c1: '#22d3ee', c2: '#0ea5e9', c3: '#67e8f9' }, // 海洋之心
  { bg: '#fdf4ff', c1: '#d8b4fe', c2: '#f0abfc', c3: '#c4b5fd' }, // 薰衣草
  { bg: '#fefce8', c1: '#fde047', c2: '#facc15', c3: '#fef08a' }, // 柠檬黄
];

const schemeIndex = hash % colorSchemes.length;
const scheme = colorSchemes[schemeIndex];

// 生成随机的光斑位置和大小
const blobs = Array.from({ length: 3 }).map((_, i) => {
  const seed = hash + i * 100;
  return {
    cx: (seed % 80) + 10 + '%',      // 10% - 90%
    cy: ((seed * 2) % 80) + 10 + '%', // 10% - 90%
    r: (seed % 20) + 30 + '%',       // 30% - 50%
    color: i === 0 ? scheme.c1 : i === 1 ? scheme.c2 : scheme.c3,
    delay: (seed % 5) + 's',         // 动画延迟
    duration: ((seed % 5) + 10) + 's' // 动画时长 10-15s
  };
});

const gradientId = `blur-filter-${hash}`;
---

<div class={`relative overflow-hidden bg-[${scheme.bg}] ${className}`}>
  <!-- SVG 弥散背景 -->
  <svg 
    class="absolute inset-0 w-full h-full"
    preserveAspectRatio="xMidYMid slice"
    xmlns="http://www.w3.org/2000/svg"
  >
    <defs>
      <filter id={gradientId} x="-50%" y="-50%" width="200%" height="200%">
        <feGaussianBlur in="SourceGraphic" stdDeviation="60" />
        <feColorMatrix type="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 18 -7" result="goo" />
      </filter>
    </defs>
    
    <g filter={`url(#${gradientId})`}>
      {blobs.map((blob, i) => (
        <circle 
          cx={blob.cx} 
          cy={blob.cy} 
          r={blob.r} 
          fill={blob.color} 
          opacity="0.8"
        >
          {/* 添加缓慢的漂浮动画 */}
          <animate 
            attributeName="cx" 
            values={`${blob.cx};${parseInt(blob.cx) + 10}%;${parseInt(blob.cx) - 10}%;${blob.cx}`} 
            dur={blob.duration} 
            repeatCount="indefinite"
            begin={blob.delay}
          />
          <animate 
            attributeName="cy" 
            values={`${blob.cy};${parseInt(blob.cy) - 10}%;${parseInt(blob.cy) + 10}%;${blob.cy}`} 
            dur={blob.duration} 
            repeatCount="indefinite" 
            begin={blob.delay}
          />
        </circle>
      ))}
    </g>
  </svg>
  
  <!-- 噪点纹理叠加 (增加质感) -->
  <div class="absolute inset-0 opacity-20 mix-blend-overlay pointer-events-none" 
       style="background-image: url('data:image/svg+xml,%3Csvg viewBox=%220 0 200 200%22 xmlns=%22http://www.w3.org/2000/svg%22%3E%3Cfilter id=%22noiseFilter%22%3E%3CfeTurbulence type=%22fractalNoise%22 baseFrequency=%220.65%22 numOctaves=%223%22 stitchTiles=%22stitch%22/%3E%3C/filter%3E%3Crect width=%22100%25%22 height=%22100%25%22 filter=%22url(%23noiseFilter)%22 opacity=%221%22/%3E%3C/svg%3E');">
  </div>

  <!-- 内容层 -->
  <div class="relative z-10 flex flex-col items-center justify-center h-full p-6 text-center">
    <!-- 装饰性图标/文字 -->
    <div class="mb-4 opacity-80">
      <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="text-slate-700 dark:text-white/90">
        <path d="M12 19l7-7 3 3-7 7-3-3z"></path>
        <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"></path>
        <path d="M2 2l7.586 7.586"></path>
        <circle cx="11" cy="11" r="2"></circle>
      </svg>
    </div>

    <!-- 标题 -->
    <h3 
      class="text-slate-800 dark:text-white font-bold text-2xl md:text-3xl tracking-tight leading-tight line-clamp-2 drop-shadow-sm"
    >
      {title}
    </h3>
    
    <!-- 装饰线 -->
    <div class="w-12 h-1 bg-slate-800/20 dark:bg-white/30 rounded-full mt-4"></div>
  </div>
</div>